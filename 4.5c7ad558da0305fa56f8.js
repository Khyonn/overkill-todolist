(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{U6jk:function(t,e,n){"use strict";n.r(e),n.d(e,"TodoModule",function(){return ft});var o=n("ofXK"),i=n("l7P3"),s=n("9jGm"),c=n("PCNd"),r=n("tyNb"),d=n("IzEk"),a=n("lJxs");const l=Object(i.n)("[TodoList] Start loading"),u=Object(i.n)("[TodoList] Data loaded",Object(i.s)()),b=Object(i.n)("[TodoList] Loading failed",Object(i.s)()),O=Object(i.n)("[TodoList] Start loading todo",Object(i.s)()),p=Object(i.n)("[TodoList] Todo loaded",Object(i.s)()),f=Object(i.n)("[TodoList] Loading todo failed",Object(i.s)()),h=Object(i.n)("[TodoList] Start update todo state",Object(i.s)()),g=Object(i.n)("[TodoList] Todo state updated",Object(i.s)()),j=Object(i.n)("[TodoList] Todo state update failed",Object(i.s)());var m=n("99NH");const y=Object(i.o)("router"),{selectRouteParam:v}=m.b(y);var T=n("fXoL");const w={EntitiesOnly:0,Both:1,None:2};function I(t){return function(e,n){const o={ids:[...n.ids],entities:Object.assign({},n.entities)},i=t(e,o);return i===w.Both?Object.assign({},n,o):i===w.EntitiesOnly?Object.assign(Object.assign({},n),{entities:o.entities}):n}}function M(t,e){const n=e(t);return Object(T.W)()&&void 0===n&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",t,"The `selectId` implementation:",e.toString()),n}function P(t){function e(e,n){const o=M(e,t);return o in n.entities?w.None:(n.ids.push(o),n.entities[o]=e,w.Both)}function n(t,n){let o=!1;for(const i of t)o=e(i,n)!==w.None||o;return o?w.Both:w.None}function o(t,e){return e.ids=[],e.entities={},n(t,e),w.Both}function i(t,e){const n=(t instanceof Array?t:e.ids.filter(n=>t(e.entities[n]))).filter(t=>t in e.entities).map(t=>delete e.entities[t]).length>0;return n&&(e.ids=e.ids.filter(t=>t in e.entities)),n?w.Both:w.None}function s(t,e){return c([t],e)}function c(e,n){const o={};return(e=e.filter(t=>t.id in n.entities)).length>0?e.filter(e=>function(e,n,o){const i=Object.assign({},o.entities[n.id],n.changes),s=M(i,t),c=s!==n.id;return c&&(e[n.id]=s,delete o.entities[n.id]),o.entities[s]=i,c}(o,e,n)).length>0?(n.ids=n.ids.map(t=>o[t]||t),w.Both):w.EntitiesOnly:w.None}function r(e,o){const i=[],s=[];for(const n of e){const e=M(n,t);e in o.entities?s.push({id:e,changes:n}):i.push(n)}const r=c(s,o),d=n(i,o);switch(!0){case d===w.None&&r===w.None:return w.None;case d===w.Both||r===w.Both:return w.Both;default:return w.EntitiesOnly}}return{removeAll:function(t){return Object.assign({},t,{ids:[],entities:{}})},addOne:I(e),addMany:I(n),addAll:I(o),setAll:I(o),setOne:I(function(e,n){const o=M(e,t);return o in n.entities?(n.entities[o]=e,w.EntitiesOnly):(n.ids.push(o),n.entities[o]=e,w.Both)}),updateOne:I(s),updateMany:I(c),upsertOne:I(function(t,e){return r([t],e)}),upsertMany:I(r),removeOne:I(function(t,e){return i([t],e)}),removeMany:I(i),map:I(function(t,e){return c(e.ids.reduce((n,o)=>{const i=t(e.entities[o]);return i!==e.entities[o]&&n.push({id:o,changes:i}),n},[]).filter(({id:t})=>t in e.entities),e)}),mapOne:I(function({map:t,id:e},n){const o=n.entities[e];return o?s({id:e,changes:t(o)},n):w.None})}}w[w.EntitiesOnly]="EntitiesOnly",w[w.Both]="Both",w[w.None]="None";var L=function(t){return t.DONE="DONE",t.TODO="TODO",t}({});class N{constructor(t="",e=L.TODO,n){this.title=t,this.state=e,this.id=n}static isDone(t){return!!t&&t.state===L.DONE}}const E=function(t={}){const{selectId:e,sortComparer:n}=Object.assign({sortComparer:!1,selectId:t=>t.id},t),o={getInitialState:function(t={}){return Object.assign({ids:[],entities:{}},t)}},s={getSelectors:function(t){const e=t=>t.ids,n=t=>t.entities,o=Object(i.q)(e,n,(t,e)=>t.map(t=>e[t])),s=Object(i.q)(e,t=>t.length);return t?{selectIds:Object(i.q)(t,e),selectEntities:Object(i.q)(t,n),selectAll:Object(i.q)(t,o),selectTotal:Object(i.q)(t,s)}:{selectIds:e,selectEntities:n,selectAll:o,selectTotal:s}}},c=n?function(t,e){const{removeOne:n,removeMany:o,removeAll:i}=P(t);function s(t,e){return c([t],e)}function c(e,n){const o=e.filter(e=>!(M(e,t)in n.entities));return 0===o.length?w.None:(u(o,n),w.Both)}function r(t,e){return e.entities={},e.ids=[],c(t,e),w.Both}function d(t,e){return a([t],e)}function a(e,n){const o=[],i=e.filter(e=>function(e,n,o){if(!(n.id in o.entities))return!1;const i=Object.assign({},o.entities[n.id],n.changes),s=M(i,t);return delete o.entities[n.id],e.push(i),s!==n.id}(o,e,n)).length>0;if(0===o.length)return w.None;{const t=n.ids,e=[];return n.ids=n.ids.filter((t,o)=>t in n.entities||(e.push(o),!1)),u(o,n),!i&&e.every(e=>n.ids[e]===t[e])?w.EntitiesOnly:w.Both}}function l(e,n){const o=[],i=[];for(const c of e){const e=M(c,t);e in n.entities?i.push({id:e,changes:c}):o.push(c)}const s=a(i,n),r=c(o,n);switch(!0){case r===w.None&&s===w.None:return w.None;case r===w.Both||s===w.Both:return w.Both;default:return w.EntitiesOnly}}function u(n,o){n.sort(e);const i=[];let s=0,c=0;for(;s<n.length&&c<o.ids.length;){const r=n[s],d=M(r,t),a=o.ids[c];e(r,o.entities[a])<=0?(i.push(d),s++):(i.push(a),c++)}o.ids=i.concat(s<n.length?n.slice(s).map(t):o.ids.slice(c)),n.forEach((e,n)=>{o.entities[t(e)]=e})}return{removeOne:n,removeMany:o,removeAll:i,addOne:I(s),updateOne:I(d),upsertOne:I(function(t,e){return l([t],e)}),addAll:I(r),setAll:I(r),setOne:I(function(e,n){const o=M(e,t);return o in n.entities?(n.ids=n.ids.filter(t=>t!==o),u([e],n),w.Both):s(e,n)}),addMany:I(c),updateMany:I(a),upsertMany:I(l),map:I(function(t,e){return a(e.ids.reduce((n,o)=>{const i=t(e.entities[o]);return i!==e.entities[o]&&n.push({id:o,changes:i}),n},[]),e)}),mapOne:I(function({map:t,id:e},n){const o=n.entities[e];return o?d({id:e,changes:t(o)},n):w.None})}}(e,n):P(e);return Object.assign(Object.assign(Object.assign({selectId:e,sortComparer:n},o),s),c)}({selectId:t=>t.id,sortComparer:class{static todoListSorter(t,e){return N.isDone(t)!==N.isDone(e)?N.isDone(t)?1:-1:0}}.todoListSorter}),C=E.getInitialState({isLoading:!1,error:null}),B="todosFeature",D=Object(i.o)(B),{selectAll:k,selectEntities:A}=E.getSelectors(Object(i.q)(D,({todoList:t})=>t)),x=Object(i.q)(v("todoId"),t=>+t),S=k,_=Object(i.q)(A,x,(t,e)=>t[e]);let q=(()=>{class t{constructor(t){this.store=t}resolve(){return this.store.dispatch(l()),this.store.select(S).pipe(Object(d.a)(1),Object(a.a)(()=>!0))}}return t.\u0275fac=function(e){return new(e||t)(T.Tb(i.h))},t.\u0275prov=T.Gb({token:t,factory:t.\u0275fac}),t})();var F=n("Wp6s");function $(t,e){if(1&t&&(T.Pb(0,"mat-card"),T.Pb(1,"mat-card-title"),T.mc(2),T.Ob(),T.Pb(3,"mat-card-content"),T.mc(4),T.Ob(),T.Ob()),2&t){const t=T.ac();T.Ab(2),T.pc("Todo #",t.todo.id," : ",t.todo.title," (",t.todo.state,")"),T.Ab(2),T.oc(" ",t.todo.description," ")}}let G=(()=>{class t{constructor(t){this.store=t}ngOnInit(){this.store.select(_).subscribe(t=>{this.todo=t})}}return t.\u0275fac=function(e){return new(e||t)(T.Kb(i.h))},t.\u0275cmp=T.Eb({type:t,selectors:[["app-todo-detail"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(t,e){1&t&&T.lc(0,$,5,4,"mat-card",0),2&t&&T.dc("ngIf",e.todo)},directives:[o.j,F.a,F.d,F.b],styles:[""]}),t})(),J=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=T.Eb({type:t,selectors:[["app-todo-detail-page"]],decls:1,vars:0,template:function(t,e){1&t&&T.Lb(0,"app-todo-detail")},directives:[G],styles:["[_nghost-%COMP%]{height:100%}app-todo-detail[_ngcontent-%COMP%]{display:flex;padding:1em;min-height:100%;box-sizing:border-box}"]}),t})();var K=n("MutI"),z=n("bSwM");const H=function(t){return[t]},U=function(t){return{"crossed-out":t}};function W(t,e){if(1&t){const t=T.Qb();T.Nb(0),T.Pb(1,"mat-checkbox",1),T.Wb("change",function(e){return T.ic(t),T.ac().onChangeState(e.checked)}),T.Ob(),T.Pb(2,"a",2),T.mc(3),T.Ob(),T.Mb()}if(2&t){const t=T.ac();T.Ab(1),T.dc("checked",t.isDone),T.Ab(1),T.dc("routerLink",T.fc(4,H,t.todo.id))("ngClass",T.fc(6,U,t.isDone)),T.Ab(1),T.nc(t.todo.title)}}let X=(()=>{class t{constructor(t){this.store=t}get isDone(){return N.isDone(this.todo)}onChangeState(t){this.store.dispatch(h({todoToUpdate:this.todo,isDone:t}))}}return t.\u0275fac=function(e){return new(e||t)(T.Kb(i.h))},t.\u0275cmp=T.Eb({type:t,selectors:[["app-todo-item"]],inputs:{todo:"todo"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"checked","change"],[1,"todo-title",3,"routerLink","ngClass"]],template:function(t,e){1&t&&T.lc(0,W,4,8,"ng-container",0),2&t&&T.dc("ngIf",e.todo)},directives:[o.j,z.a,r.f,o.h],styles:["[_nghost-%COMP%]{display:flex;width:100%}.todo-title[_ngcontent-%COMP%]{display:inline-block;padding:0 .5em;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;vertical-align:middle}.todo-title.crossed-out[_ngcontent-%COMP%]{text-decoration:line-through}a[_ngcontent-%COMP%]{color:inherit;text-decoration:none}"]}),t})();function R(t,e){if(1&t&&(T.Pb(0,"mat-list-item"),T.Lb(1,"app-todo-item",2),T.Ob()),2&t){const t=e.$implicit;T.Ab(1),T.dc("todo",t),T.Bb("id","todo_"+t.id)}}function Q(t,e){if(1&t&&(T.Pb(0,"mat-card"),T.Pb(1,"mat-card-title"),T.mc(2,"Todo list"),T.Ob(),T.Pb(3,"mat-card-content"),T.Pb(4,"mat-list"),T.lc(5,R,2,2,"mat-list-item",1),T.Ob(),T.Ob(),T.Ob()),2&t){const t=T.ac();T.Ab(5),T.dc("ngForOf",t.todos)}}let Y=(()=>{class t{constructor(t){this.store=t}ngOnInit(){this.store.select(S).subscribe(t=>this.todos=t)}}return t.\u0275fac=function(e){return new(e||t)(T.Kb(i.h))},t.\u0275cmp=T.Eb({type:t,selectors:[["app-todo-list"]],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"todo"]],template:function(t,e){1&t&&T.lc(0,Q,6,1,"mat-card",0),2&t&&T.dc("ngIf",null==e.todos?null:e.todos.length)},directives:[o.j,F.a,F.d,F.b,K.a,o.i,K.b,X],styles:[""]}),t})(),Z=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=T.Eb({type:t,selectors:[["app-todo-page"]],decls:4,vars:0,consts:[[1,"left"],[1,"right"]],template:function(t,e){1&t&&(T.Pb(0,"div",0),T.Lb(1,"app-todo-list"),T.Ob(),T.Pb(2,"div",1),T.Lb(3,"router-outlet"),T.Ob())},directives:[Y,r.h],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column-reverse}.left[_ngcontent-%COMP%], .right[_ngcontent-%COMP%]{flex:1 1 0}.left[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}app-todo-list[_ngcontent-%COMP%]{width:100%}@media (min-width:501px){[_nghost-%COMP%]{flex-direction:row}app-todo-list[_ngcontent-%COMP%]{margin:1em 0;width:500px}}"]}),t})(),V=(()=>{class t{constructor(t){this.store=t}resolve(t){return this.store.dispatch(O({todoId:+t.params.todoId})),this.store.select(_).pipe(Object(d.a)(1),Object(a.a)(()=>!0))}}return t.\u0275fac=function(e){return new(e||t)(T.Tb(i.h))},t.\u0275prov=T.Gb({token:t,factory:t.\u0275fac}),t})();const tt=[{path:"",component:Z,resolve:{todos:q},children:[{path:":todoId",component:J,resolve:{todo:V}}]}];let et=(()=>{class t{}return t.\u0275mod=T.Ib({type:t}),t.\u0275inj=T.Hb({factory:function(e){return new(e||t)},imports:[[r.g.forChild(tt)],r.g]}),t})();const nt=t=>Object.assign(Object.assign({},t),{isLoading:!0}),ot=(t,{error:e})=>Object.assign(Object.assign({},t),{error:e}),it=t=>Object.assign(Object.assign({},t),{isLoading:!1,error:null}),st={todoList:Object(i.p)(C,Object(i.r)(l,nt),Object(i.r)(u,(t,{todos:e})=>E.addMany(e,it(t))),Object(i.r)(b,ot),Object(i.r)(h,nt),Object(i.r)(g,(t,{updatedTodo:e})=>(t=it(t),N.isDone(e)?Object.assign(Object.assign({},t),{ids:[...t.ids.filter(t=>t!==e.id),e.id],entities:Object.assign(Object.assign({},t.entities),{[e.id]:e})}):Object.assign(Object.assign({},t),{entities:Object.assign(Object.assign({},t.entities),{[e.id]:e})}))),Object(i.r)(j,ot))};var ct=n("LRne"),rt=n("5+tZ"),dt=n("JIr8"),at=n("vkgz"),lt=n("XDbj"),ut=n("tk/3");const bt=new Map;let Ot=(()=>{class t{constructor(t){this.http=t}getTodos(){return this.http.get("assets/mocks/todos.json").pipe(Object(at.a)(t=>{t.forEach(t=>bt.set(t.id,Object.assign({},t)))}))}getTodo(t){return Object(ct.a)(bt.get(t)).pipe(Object(lt.a)())}updateTodo(t){return Object(ct.a)(bt.set(t.id,Object.assign({},t)).get(t.id))}}return t.\u0275fac=function(e){return new(e||t)(T.Tb(ut.a))},t.\u0275prov=T.Gb({token:t,factory:t.\u0275fac}),t})(),pt=(()=>{class t{constructor(t,e){this.action$=t,this.todoService=e,this.setTodoList$=Object(s.c)(()=>this.action$.pipe(Object(s.d)(l),Object(rt.a)(()=>this.todoService.getTodos().pipe(Object(a.a)(t=>u({todos:t})),Object(dt.a)(()=>Object(ct.a)(b({error:"Failed to load todos"}))))))),this.updateTodo$=Object(s.c)(()=>this.action$.pipe(Object(s.d)(h),Object(rt.a)(({todoToUpdate:t,isDone:e})=>{const n=Object.assign(Object.assign({},t),{state:e?L.DONE:L.TODO});return this.todoService.updateTodo(n).pipe(Object(a.a)(t=>g({updatedTodo:t})),Object(dt.a)(()=>Object(ct.a)(j({error:"Failed to update todo"}))))}))),this.loadTodo$=Object(s.c)(()=>this.action$.pipe(Object(s.d)(O),Object(rt.a)(({todoId:t})=>this.todoService.getTodo(t).pipe(Object(a.a)(t=>p({todo:t})),Object(dt.a)(()=>Object(ct.a)(f({error:"Failed to retrieve todo"})))))))}}return t.\u0275fac=function(e){return new(e||t)(T.Tb(s.a),T.Tb(Ot))},t.\u0275prov=T.Gb({token:t,factory:t.\u0275fac}),t})(),ft=(()=>{class t{}return t.\u0275mod=T.Ib({type:t}),t.\u0275inj=T.Hb({factory:function(e){return new(e||t)},providers:[Ot,q,V],imports:[[o.b,et,c.a,i.j.forFeature(B,st),s.b.forFeature([pt])]]}),t})()}}]);